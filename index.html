<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/index.md at 21-04-2022 21:46
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>cocktails &#x2013; DAW - M7</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarEnabled">
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
            <div class="container">
              <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </a>
          <nav class="nav-collapse">
            <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Info and Reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="jacoco/index.html" title="Covertura">Covertura</a></li>
            <li><a href="project-reports.html" title="Reports">Reports</a></li>
            <li><a href="project-info.html" title="Info">Info</a></li>
            <li><a href="apidocs" title="JavaDocs">JavaDocs</a></li>
            <li><a href="https://github.com/ofornes/daw-m7-uf1" title="Source code">Source code</a></li>
            <li><a href="scm.html" title="SCM">SCM</a></li>
            <li><a href="team.html" title="Desenvolupadors">Desenvolupadors</a></li>
        </ul>
      </li>
            </ul>
          </nav>
          <div class="nav-collapse">
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="./" id="bannerLeft"><h2>cocktails</h2>
</a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 21-04-2022 21:46<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.1.2</li>
          </ul>
        </div>
      </header>
        <main id="bodyColumn" >
<h1>DAW - M7</h1>
<p><i>Desenvolupament web en entorn servidor</i></p>
<p><b>Continguts</b></p>
<ol style="list-style-type: decimal">

<li><a href="#Introducci.C3.B3">Introducci&#xf3;</a></li>
<li><a href="#Prova_UF1">Prova UF1</a>
<ol style="list-style-type: decimal">

<li><a href="#Dades">Dades</a></li>
<li><a href="#Autenticaci.C3.B3_i_autoritzaci.C3.B3">Autenticaci&#xf3; i autoritzaci&#xf3;</a></li>
<li><a href="#Controlador">Controlador</a></li>
<li><a href="#Vistes">Vistes</a></li>
</ol>
</li>
<li>Prova UF3</li>
</ol><hr /><section>
<h2><a name="Introducci.C3.B3"></a>Introducci&#xf3;</h2>
<p>Per a resoldre la prova UF1, s&#x2019;ha creat un projecte Java amb maven.</p>
<p>S&#x2019;ha utilitzat Spring com a framework de desenvolupament per tal d&#x2019;aprofitar els recursos i facilitats que proporciona (IoC, Dependency Injection, etc.)</p>
<p>Per a crear els <i>JavaBeans</i> s'ha utilitzat la llibreria <a class="externalLink" href="https://projectlombok.org/">Lombok</a> que simplifica la implementaci&#xf3; i redueix els errors t&#xed;pics de la farragosa i mec&#xe0;nica feina de implementar <i>getters</i> i <i>setters</i>.</p>
<p>Aquesta utilitat disposa d'un <i>plugin</i> per a diferents IDEs de manera que ofereix els m&#xe8;todes d'acc&#xe9;s a les propietats <i>on the fly</i>.</p>
<p>S&#x2019;ha utilitzat el subm&#xf2;dul Spring MVC per a la part Web.</p>
<p>Tamb&#xe9; s&#x2019;utilitza el subm&#xf2;dul Spring de seguretat per tal de fer el login.</p></section><section>
<h2><a name="Prova_UF1"></a>Prova UF1</h2>
<p>Fer un sistema de login i un CRUD sense base de dades, totes les variables i maquetaci&#xf3; est&#xe0; adjunta.</p>
<p>S'ha optat, com ja s'ha esmentat, pel framework Spring MVC.</p>
<p>S'han traslladat els models PHP a models HTML amb el llenguatge de plantilles Thymeleaf.</p>
<p>La classe de configuraci&#xf3; <a href="xref/cat/albirar/daw/cocktails/CocktailsConfiguration.html">cat.albirar.daw.cocktails.CocktailsConfiguration</a> &#xe9;s l&#x2019;encarregada de crear els elements <i>injectables</i> de l&#x2019;aplicaci&#xf3;.</p><section>
<h3><a name="Dades"></a>Dades</h3>
<p>Les dades s&#x2019;han despla&#xe7;at de la vista (vars.php) al codi, a un arxiu json (<code>/cocktails/src/main/resources/cocktails.json</code>). Aquest arxiu es carrega a un servei espec&#xed;fic format per una interf&#xed;cie (contracte) i la implementaci&#xf3;.</p>
<ul>

<li>Interf&#xed;cie: <a href="xref/cat/albirar/daw/cocktails/service/ICocktailsService.html">cat.albirar.daw.cocktails.service.ICocktailsService</a></li>
<li>Implementaci&#xf3;: <a href="xref/cat/albirar/daw/cocktails/service/impl/CocktailsServiceImpl.html">cat.albirar.daw.cocktails.service.impl.CocktailsServiceImpl</a></li>
</ul></section><section>
<h3><a name="Autenticaci.C3.B3_i_autoritzaci.C3.B3"></a>Autenticaci&#xf3; i autoritzaci&#xf3;</h3>
<p>L&#x2019;autenticaci&#xf3; i l&#x2019;autoritzaci&#xf3; es fa amb el m&#xf2;dul spring-security. Els usuaris amb les passwords encriptades es creen inicialment per codi i s&#x2019;emmagatzemem en mem&#xf2;ria.</p>
<p>A la classe de configuraci&#xf3;, el m&#xe8;tode <a href="xref/cat/albirar/daw/cocktails/CocktailsConfiguration.html#L54">CocktailsConfiguration.users()</a> s&#x2019;encarrega de crear la infraestructura d&#x2019;autenticaci&#xf3; i assignaci&#xf3; de <i>roles</i>.</p>

<div class="source"><pre class="prettyprint"><code class="language-java">	@Bean
	public UserDetailsService users() {
		// The builder will ensure the passwords are encoded before saving in memory
		UserBuilder userBuilder = User.builder();
		
		UserDetails admin = userBuilder
				.username(&quot;admin&quot;)
				.password(ADMIN_ENC_PASS)
				.roles(&quot;USER&quot;)
				.build();
		UserDetails pepe = userBuilder
				.username(&quot;pepe&quot;)
				.password(PEPE_ENC_PASS)
				.roles(&quot;USER&quot;)
				.build();
		UserDetails manolo = userBuilder
				.username(&quot;manolo&quot;)
				.password(MANOLO_ENC_PASS)
				.roles(&quot;USER&quot;)
				.build();
		return new InMemoryUserDetailsManager(admin, pepe, manolo);
	}
</code></pre></div>
<p>Les constants <a href="xref/cat/albirar/daw/cocktails/CocktailsConfiguration.html#L49">ADMIN_ENC_PASS</a>, <a href="xref/cat/albirar/daw/cocktails/CocktailsConfiguration.html#L50">PEPE_ENC_PASS</a> i <a href="xref/cat/albirar/daw/cocktails/CocktailsConfiguration.html#L51">MANOLO_ENC_PASS</a> contenen les passwords encriptades de <code>vars.php</code>.</p>
<p>La classe <a href="xref/cat/albirar/daw/cocktails/crypt/CocktailsPasswordEncoder.html">cat.albirar.daw.cocktails.crypt.CocktailsPasswordEncoder</a> &#xe9;s l&#x2019;encarregada de codificar les contrasenyes introdu&#xef;des pels usuaris per tal de validar-les amb les dels usuaris registrats.</p>
<p>Implementa el digest <b>SHA-512</b> i concatena el sufix <code>SuperSecret.</code> a les passwords abans de calcular el digest.</p>
<p>S&#x2019;assigna el <i>rol</i> <code>USER</code> a tots els usuaris per tal de definir la pol&#xed;tica d&#x2019;autoritzaci&#xf3;.</p>
<p>Aquesta pol&#xed;tica (paths HTTP i <i>rols</i> que hi poden accedir) es defineix, tamb&#xe9;, a la classe de configuraci&#xf3;, al m&#xe8;tode <a href="xref/cat/albirar/daw/cocktails/CocktailsConfiguration.html#L82">CocktailsConfiguration.web()</a>:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">	@Bean
	public SecurityFilterChain web(HttpSecurity http) throws Exception {
		http
			.authorizeHttpRequests(authorize -&gt; authorize
					.mvcMatchers(&quot;/&quot;).permitAll()
					.mvcMatchers(&quot;/list&quot;, &quot;/show/*&quot;, &quot;/logout&quot;).hasRole(&quot;USER&quot;)
					.anyRequest().denyAll())
			.formLogin(form -&gt; form
					.loginPage(&quot;/&quot;)
					.defaultSuccessUrl(&quot;/&quot;, false)
					.failureUrl(&quot;/&quot;)
					)
			.logout(logout -&gt; logout
		            .logoutRequestMatcher(new AntPathRequestMatcher(&quot;/logout&quot;, &quot;GET&quot;))
		            .clearAuthentication(true)
		            .invalidateHttpSession(true)
		            .logoutSuccessUrl(&quot;/&quot;)
		            )
			;
		return http.build();
	}
</code></pre></div>
<p>L&#x2019;acc&#xe9;s a l&#x2019;arrel (index.html) &#xe9;s perm&#xe8;s a tothom, ja que &#xe9;s la <i>p&#xe0;gina de login</i>. Els paths de <i>list</i> i <i>show</i> estan restringits a usuaris autenticats amb el rol <i>USER</i>, que &#xe9;s el que hem definit com a rol d&#x2019;autoritzaci&#xf3; a la gesti&#xf3; d&#x2019;usuaris.</p>
<p>Es defineix, tamb&#xe9;, la p&#xe0;gina de <i>login</i> i la de <i>logout</i>.</p>
<p>Per &#xfa;ltim, es restringeix l&#x2019;acc&#xe9;s a qualsevol altre <i>path</i>.</p></section><section>
<h3><a name="Controlador"></a>Controlador</h3>
<p>En el patr&#xf3; MVC de l&#x2019;aplicaci&#xf3;, el controlador est&#xe0; implementat per la classe <a href="xref/cat/albirar/daw/cocktails/controllers/MainController.html">cat.albirar.daw.cocktails.controllers.MainController</a>.</p>
<p>Els m&#xe8;todes estan anotats per tal d&#x2019;establir la relaci&#xf3; entre el path i m&#xe8;tode http i el m&#xe8;tode de la classe que ho gestiona, per exemple:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">@GetMapping(&quot;/list&quot;)
public String getList(Model model) {
	model.addAttribute(&quot;cocktails&quot;, cocktailService.findAll());
	return &quot;list&quot;;
}
</code></pre></div>
<p>Les dades provenen del servei que hem esmentat abans i s&#x2019;injecta al controlador amb la interf&#xed;cie:</p>

<div class="source"><pre class="prettyprint"><code class="language-java">@Controller
public class MainController {
	@Autowired
	private ICocktailsService cocktailService;
//...
}
</code></pre></div>
<p>Spring troba la implementaci&#xf3; corresponent per l&#x2019;anotaci&#xf3; de la classe (<code>@Service</code>) i pel fet que implementa la mateixa interf&#xed;cie desitjada en la injecci&#xf3; (veure <a href="xref/cat/albirar/daw/cocktails/service/impl/CocktailsServiceImpl.html">CocktailsServiceImpl</a>).</p></section><section>
<h3><a name="Vistes"></a>Vistes</h3>
<p>Les vistes estan implementades amb el sistema de plantilles <a class="externalLink" href="https://www.thymeleaf.org/">Thymeleaf (https://www.thymeleaf.org/)</a> que t&#xe9; la virtut d&#x2018;integrar-se amb l&#x2019;html de manera que es pot veure pr&#xe0;cticament renderitzat sense necessitat d&#x2019;execuci&#xf3;.</p>
<p>Els models de dades passat a les vistes permet que les plantilles mostrin el contingut.</p>
<p>En el cas de la p&#xe0;gina <i>show</i>, s&#x2019;ha afegit un par&#xe0;metre de path, que consisteix en afegir el codi del cocktail com a segment final del path. Per exemple, per a veure el detall del cocktail amb <i>id</i> 12562, el path &#xe9;s <code>/show/12562</code>. D&#x2019;aquesta manera, les URLs resulten molt m&#xe9;s netes i f&#xe0;cils d&#x2019;indexar pels cercadors.</p></section></section>
        </main>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>&#169;      2022
</p>
        </div>
        <p id="poweredBy" class="pull-right"><a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
</p>
      </div>
    </footer>
  </body>
</html>